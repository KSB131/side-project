<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë©”ì¸ í˜ì´ì§€</title>
    <link rel="stylesheet" href="/main.css">
    <style>
        .hidden { display: none; }
        .friend-card { padding: 8px; border: 1px solid #ddd; border-radius: 6px; margin-bottom: 8px; }
        .friend-card p { margin: 4px 0; }
        .btn-ghost { background: transparent; border: 1px solid #ccc; padding: 6px 10px; border-radius: 4px; }
    </style>
</head>
<body>
    <header>
        <h1>í™˜ì˜í•©ë‹ˆë‹¤!</h1>
        <nav>
            <a href="/">í™ˆ</a>
            <a href="/profile">í”„ë¡œí•„</a>
            <a href="/logout" id="logoutBtn">ë¡œê·¸ì•„ì›ƒ</a>
            <a href="/dashboard">ëŒ€ì‹œë³´ë“œ</a>
        </nav>
    </header>

    <!-- ë©”ì¸ ì „ì²´ë¥¼ ê°ì‹¸ëŠ” ìš”ì†Œ (ìˆ¨ê¹€/í‘œì‹œ í† ê¸€ ëŒ€ìƒ) -->
    <main id="main-content">
        <section class="welcome-section">
            <h2>ì•ˆë…•í•˜ì„¸ìš”, ì‚¬ìš©ìë‹˜!</h2>
            <p>ì´ê³³ì€ ë©”ì¸ í˜ì´ì§€ì…ë‹ˆë‹¤. ì›í•˜ëŠ” ê¸°ëŠ¥ì„ ì´ìš©í•´ë³´ì„¸ìš”.</p>
        </section>
        
        <section class="cards">
            <div class="card">
                <h3>ì¹œêµ¬</h3>
                <p>ìƒˆë¡œìš´ ì¹œêµ¬ê°€ ì¶”ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤. í™•ì¸í•´ë³´ì„¸ìš”!</p>
                <button id="friend" type="button" onclick="openFriends()">ìì„¸íˆ ë³´ê¸°</button>
            </div>
            <div class="card">
                <h3>ê³µì§€ì‚¬í•­</h3>
                <p>ìƒˆë¡œìš´ ê³µì§€ê°€ ìˆìŠµë‹ˆë‹¤. í™•ì¸í•´ë³´ì„¸ìš”!</p>
                <button id="notice" type="button" onclick="openSchedule()">ìì„¸íˆ ë³´ê¸°</button>
            </div>
            <div class="card">
                <h3>ì—…ë°ì´íŠ¸</h3>
                <p>ì„œë¹„ìŠ¤ ì—…ë°ì´íŠ¸ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
                <button id="update" type="button">ìì„¸íˆ ë³´ê¸°</button>
            </div>
            <div class="card">
                <h3>ë¬¸ì˜</h3>
                <p>ë¬¸ì˜ì‚¬í•­ì´ ìˆìœ¼ë©´ ì—¬ê¸°ë¥¼ í´ë¦­í•˜ì„¸ìš”.</p>
                <button id="call" type="button">ë¬¸ì˜í•˜ê¸°</button>
            </div>
        </section>
    </main>

    <!-- í‰ì†Œì—ëŠ” ìˆ¨ê¹€. ë³´ì—¬ì¤„ ë•ŒëŠ” main-contentë¥¼ ìˆ¨ê¸°ê³  ì´ ì„¹ì…˜ë§Œ í‘œì‹œ -->
    <section id="schedule" class="hidden" tabindex="-1" aria-hidden="true">
        <h2>ğŸ“… ìš°ë¦¬ë“¤ì˜ ì¼ì •</h2>
        <p>ì—¬ê¸°ì— ì¼ì • ëª©ë¡ì„ í‘œì‹œí•©ë‹ˆë‹¤.</p>

        <button type="button">ìƒˆ ì¼ì • ì¶”ê°€í•˜ê¸°</button>
        <div>
            <button type="button" class="btn-ghost" onclick="backToMain()">ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
        </div>
    </section>

    <section id="friends" class="hidden" tabindex="-1" aria-hidden="true">
        <h2>ì¹œêµ¬</h2>
        <button id="friendadd" type="button" onclick="openFriendList()">â• ì¹œêµ¬ ì¶”ê°€í•˜ê¸°</button>
        <p>ì¹œêµ¬ ëª©ë¡ì„ í‘œì‹œí•©ë‹ˆë‹¤.</p>
        <div style="margin:8px 0">
            <button id="load-friends-btn" type="button" class="btn-ghost">ì¹œêµ¬ ëª©ë¡ ìƒˆë¡œê³ ì¹¨</button>
            <button type="button" class="btn-ghost" onclick="backToMain()">ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
        </div>
    </section>

    <section id="friendlist" class="hidden" tabindex="-1" aria-hidden="true">
        <div id="friend-items" aria-live="polite"></div>
    </section>

    <footer>
        <p>&copy; 2025 My Project. All rights reserved.</p>
    </footer>

    <script>
        // ë°ì´í„° (ì‹¤ì œëŠ” ì„œë²„ì—ì„œ fetch í•´ì˜¬ ìˆ˜ ìˆìŒ)
        let friendData = [
            { name: "ê¹€ì˜ì", category: "ìš´ë™", desc: "ì•„ì¹¨ ìš´ë™", phone: "01012345678"},
            { name: "ë°•ì² ìˆ˜", category: "ìŠ¤í„°ë””", desc: "ìë°”ìŠ¤í¬ë¦½íŠ¸ ê³µë¶€", phone: "01098765432"}
        ];

        // DOM ë ˆí¼ëŸ°ìŠ¤
        const mainEl = document.getElementById('main-content');
        const scheduleEl = document.getElementById('schedule');
        const friendsEl = document.getElementById('friends');
        const friendlistEl = document.getElementById('friendlist');
        const friendItemsEl = document.getElementById('friend-items');
        const loadFriendsBtn = document.getElementById('load-friends-btn');

        // ì¡´ì¬ í™•ì¸ ìœ í‹¸
        function exists(el) { return el instanceof Element; }

        // ì„¹ì…˜ ë§¤í•‘
        const sections = {
            main: mainEl,
            schedule: scheduleEl,
            friends: friendsEl,
            friendlist: friendlistEl
        };

        // ì„¹ì…˜ì´ ë³´ì—¬ì§ˆ ë•Œ ì‹¤í–‰í•  ì½œë°±ë“¤
        const onShow = {
            friends: () => loadFriendlist(),
            schedule: () => {/* í•„ìš” ì‹œ ì¼ì • ë¡œë“œ */},
            friendlist: () => loadFriendlist()
        };

        // ì„¹ì…˜ ë³´ì—¬ì£¼ê¸°/ìˆ¨ê¸°ê¸° ê³µìš© í•¨ìˆ˜
        function showSection(name, push = true) {
            if (!sections[name]) return;

            Object.entries(sections).forEach(([key, el]) => {
                if (!exists(el)) return;
                const isTarget = (key === name);
                el.classList.toggle('hidden', !isTarget);
                el.setAttribute('aria-hidden', (!isTarget).toString());
            });

            const target = sections[name];
            if (exists(target)) {
                try { target.focus({ preventScroll: true }); } catch(e) {}
            }

            // onShow ì½œë°± í˜¸ì¶œ (ë¹„ë™ê¸° ê°€ëŠ¥)
            if (onShow[name]) {
                try { onShow[name](); } catch(e) { console.error(e); }
            }

            if (push) {
                const urlHash = (name === 'main') ? (location.pathname + location.search) : `#${name}`;
                const stateObj = (name === 'main') ? {} : { page: name };
                history.pushState(stateObj, '', urlHash);
            }
        }

        // ì¹œêµ¬ ëª©ë¡ ë¡œë”© í•¨ìˆ˜
        async function loadFriendlist() {
            // ë§Œì•½ ì„œë²„ì—ì„œ ê°€ì ¸ì˜¨ë‹¤ë©´ ì•„ë˜ì²˜ëŸ¼ fetch ì‚¬ìš©
            // const res = await fetch('/api/friends'); friendData = await res.json();

            // ì´ˆê¸°í™”
            friendItemsEl.innerHTML = '';

            if (!Array.isArray(friendData) || friendData.length === 0) {
                friendItemsEl.innerHTML = '<p>ì¹œêµ¬ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            friendData.forEach(friend => {
                const card = document.createElement('article');
                card.className = 'friend-card';
                card.innerHTML = `
                    <p><strong>ì´ë¦„:</strong> ${escapeHtml(friend.name)}</p>
                    <p><strong>ì¹´í…Œê³ ë¦¬:</strong> ${escapeHtml(friend.category)}</p>
                    <p><strong>ì„¤ëª…:</strong> ${escapeHtml(friend.desc)}</p>
                    <p><strong>ì „í™”:</strong> <a href="tel:${escapeHtml(friend.phone)}">${escapeHtml(friend.phone)}</a></p>
                `;
                friendItemsEl.appendChild(card);
            });
        }

        // ë’¤ë¡œê°€ê¸°/ì•ìœ¼ë¡œê°€ê¸° ì²˜ë¦¬
        window.addEventListener('popstate', (e) => {
            const page = (e.state && e.state.page) ? e.state.page : (location.hash ? location.hash.replace('#', '') : 'main');
            if (page in sections) showSection(page, false);
            else showSection('main', false);
        });

        // ë¡œë“œ ì‹œ í•´ì‹œ ëŒ€ì‘
        window.addEventListener('load', () => {
            const initial = location.hash ? location.hash.replace('#', '') : 'main';
            if (initial in sections) {
                if (initial !== 'main') history.replaceState({ page: initial }, '', `#${initial}`);
                showSection(initial, false);
            } else {
                showSection('main', false);
            }
        });

        // ì„¹ì…˜ ì˜¤í”ˆ/í´ë¡œì¦ˆ ë³´ì¡° í•¨ìˆ˜
        function openSchedule() { showSection('schedule'); }
        function openFriends() { showSection('friends'); }
        function backToMain() { showSection('main'); }
        function openFriendList() { showSection('friendlist'); }

        // ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼
        const logoutBtn = document.getElementById('logoutBtn');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', (e) => {
                e.preventDefault();
                localStorage.removeItem('token');
                alert('ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.');
                window.location.href = '/';
            });
        }

        // ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ ì—°ê²°
        if (loadFriendsBtn) loadFriendsBtn.addEventListener('click', loadFriendlist);
    </script>
</body>
</html>
